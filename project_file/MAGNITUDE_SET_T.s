ADC1_SSFIFO3 	EQU 0x400390A8 ; Channel 3 results
ADC1_RIS 		EQU 0x40039004 ; Interrupt status
ADC1_PSSI 		EQU 0x40039028 ; Initiate sample
ADC1_ISC		EQU 0x4003900C ; Interrupt status clear

;LABEL		DIRECTIVE	VALUE		COMMENT
			AREA    	MAGNITUDE_SET_T, READONLY, CODE
			THUMB
			EXPORT  	MAGNITUDE_SET_T ; Make available
			IMPORT		CURRENT_PTR
			IMPORT		READ_COMPLETE
			IMPORT 		AMPLITUDE_T 

MAGNITUDE_SET_T_	PROC
			LDR		R3, =ADC1_RIS ; INT ADDRESS 
			LDR		R4, =ADC1_SSFIFO3 ; RESULT ADDRESS 
			LDR		R2, =ADC1_PSSI ; SAMPLING SEQUENCE INITIATE 
			LDR		R6, =ADC1_ISC 
			
sample 		LDR		R0, [R2]
			ORR		R0, R0, 0x08 ; SET BIT 3 FOR PSSI 
			STR		R0, [R2] 
check 		LDR		R0, [R3]
			ANDS	R0, #0x08
			BEQ		check 
			; READ THE DATA 
			LDR		R0, [R4]
			; SCALE IT BETWEEN 100-300
			LDR		R1, =200 
			MUL		R0, R1
			LDR		R1, =4095 
			UDIV	R0, R1
			LDR		R1, =100
			ADD		R0, R1 
			
			LDR		R1, =AMPLITUDE_T
			STR		R0, [R1]
			
			BX LR 
			ENDP 
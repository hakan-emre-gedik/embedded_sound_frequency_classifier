;System Registers
SYSCTL_RCGCGPIO 	EQU 0x400FE608 ; GPIO Gate Control
SYSCTL_RCGCTIMER 	EQU 0x400FE604 ; GPTM Gate Control
; 16/32 TIMER 1 REGISTERS 
TIMER1_CFG			EQU 0x40031000
TIMER1_TAMR			EQU 0x40031004
TIMER1_CTL			EQU 0x4003100C
TIMER1_IMR			EQU 0x40031018
TIMER1_RIS			EQU 0x4003101C ; Timer Interrupt Status
TIMER1_ICR			EQU 0x40031024 ; Timer Interrupt Clear
TIMER1_TAILR		EQU 0x40031028 ; Timer interval
TIMER1_TAPR			EQU 0x40031038
TIMER1_TAR			EQU	0x40031048 ; Timer register
TIMER1_MIS			EQU 0x40031020 ; Masked interrupt status 

; 16/32 TIMER 2 REGISTERS 
TIMER0_CFG			EQU 0x40030000
TIMER0_TAMR			EQU 0x40030004
TIMER0_CTL			EQU 0x4003000C
TIMER0_IMR			EQU 0x40030018
TIMER0_RIS			EQU 0x4003001C ; Timer Interrupt Status
TIMER0_ICR			EQU 0x40030024 ; Timer Interrupt Clear
TIMER0_TAILR		EQU 0x40030028 ; Timer interval
TIMER0_TAPR			EQU 0x40030038
TIMER0_TAR			EQU	0x40030048 ; Timer register
TIMER0_MIS			EQU 0x40030020 ; Masked interrupt status 

; NVIC ENABLE AND SET PRIORITY REGISTERS 
NVIC_EN 		EQU 0xE000E100 
NVIC_TIMER1_PRI 	EQU 0xE000E814
NVIC_TIMER0_PRI 	EQU 0xE000E810

;LABEL		DIRECTIVE	VALUE		COMMENT
			AREA    	TIMERS_INIT, READONLY, CODE
			THUMB
			EXPORT  	TIMERS_INIT ; Make available
			
			
			; USING TIMER1, WE CREATE PERIODIC SIGNAL REQUIRED FOR 
			; DRIVING THE STEP MOTOR, WHEREAS USING TIMER0, WE CONTROL 
			; THE INPUT POWER TO THE ONBOARD LEDS 
TIMERS_INIT_		PROC 
			LDR		R1, =SYSCTL_RCGCTIMER
			MOV		R0, #0x03 ; START TIMER 1 AND 0  
			STR		R0, [R1]
			NOP 
			NOP 
			NOP 
			
			LDR		R1, =TIMER1_CTL 
			LDR		R0, [R1]
			BIC 	R0, #0x01 
			STR		R0, [R1]
			
			LDR		R1, =TIMER1_CFG
			MOV		R0, #0x00 ; SET FOR 32 BIT MODE 
			STR		R0, [R1]
			
			LDR		R1, =TIMER1_TAMR
			MOV		R0, #0x02 ; SET FOR PERIODIC TIMER MODE 
			STR		R0, [R1]
			
			LDR		R1, =TIMER1_TAILR
			LDR 	R0, =140000 ; 40000 ILR MAXIMUM FREUQENCY FOR 
			STR		R0, [R1] ; DRIVING THE STEP MOTOR WITHOUT VIBRATION 
							 ; 240000 ILR IS THE MINIMUM FREQUENCY CHOSEN 
						
			LDR		R1, =TIMER1_ICR 
			LDR		R0, [R1]
			ORR		R0, 0x01 
			STR		R0, [R1]
			
			LDR		R1, =TIMER1_IMR
			LDR		R0, [R1]
			ORR		R0, #0x01 ; ENABLE INTERRUPTS FOR TIMER 1 
			STR		R0, [R1]

			; ACTIVATE TIMER 1 TOGETHER WITH TIMER 2 
			
			LDR		R1, =TIMER0_CTL 
			LDR		R0, [R1] 
			BIC 	R0, #0x01 
			
			LDR		R1, =TIMER0_CFG 
			MOV		R0, #0x00 
			STR		R0, [R1]
			
			LDR		R1, =TIMER0_TAMR 
			MOV		R0, #0x02 ; SET FOR PERIODIC MODE 
			STR		R0, [R1]
			
			LDR		R1, =TIMER0_TAILR
			LDR		R0, =100000 ; FREQUENCY OF THE PWM SIGNAL WILL NOT BE SIGNIFICANT 
			STR		R0, [R1]
			
			LDR		R1, =TIMER0_ICR 
			LDR		R0, [R1]
			ORR		R0, 0x01 
			STR		R0, [R1]
			
			LDR		R1, =TIMER0_IMR
			LDR		R0, [R1]
			ORR		R0, #0x01 ; ENABLE INTERRUPTS FOR TIMER 0 
			STR		R0, [R1]
			
			
			; ACTIVATE INTERRUPTS IN NVIC 
			LDR		R1, =NVIC_EN 
			LDR		R0, [R1]
			MOV		R0, #0x01 
			LSL		R0, #21 ; FOR TIMER1A 
			STR		R0, [R1] 
			
			LDR		R1, =NVIC_EN 
			LDR		R0, [R1]
			MOV		R0, #0x01 
			LSL		R0, #19 ; FOR TIMER0A  
			STR		R0, [R1] 
			
			LDR		R1, =NVIC_TIMER1_PRI 
			MOV		R0, #6 ; SET DECIMAL 80 AS PRIORITY 
			LSL 	R0, #13
			STR		R0, [R1] 
			
			LDR		R1, =NVIC_TIMER0_PRI 
			MOV		R0, #7; SET DECIMAL 81 AS PRIORITY
			LSL		R0, #29 
			STR		R0, [R1] 
			
			
			; ACTIVATE TIMERS
			LDR		R1, =TIMER1_CTL 
			LDR		R0, [R1]
			ORR		R0, #0x01
			STR		R0, [R1]
			
			LDR		R1, =TIMER0_CTL 
			LDR		R0, [R1]
			ORR		R0, #0x01
			STR		R0, [R1]
	
			
			BX LR 
			
			
			ENDP 
			END 

